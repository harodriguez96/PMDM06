{"version":3,"file":"src_app_pages_fotos_fotos_module_ts.js","mappings":"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","sources":["./src/app/pages/fotos/fotos-routing.module.ts","./src/app/pages/fotos/fotos.module.ts","./src/app/pages/fotos/fotos.page.ts","./src/app/servicios/fotos.service.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { FotosPage } from './fotos.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: FotosPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class FotosPageRoutingModule {}\r\n","import { MisComponentesModule } from './../../components/mis-componentes.module';\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { FotosPageRoutingModule } from './fotos-routing.module';\r\n\r\nimport { FotosPage } from './fotos.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    FotosPageRoutingModule,\r\n    MisComponentesModule\r\n  ],\r\n  declarations: [FotosPage]\r\n})\r\nexport class FotosPageModule {}\r\n","import { FotosService } from './../../servicios/fotos.service';\r\nimport { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-fotos',\r\n  templateUrl: './fotos.page.html',\r\n  styleUrls: ['./fotos.page.scss'],\r\n})\r\nexport class FotosPage implements OnInit {\r\n\r\n  constructor(public usarCamara: FotosService) { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n  public takePicture() {\r\n    this.usarCamara.sacarFoto();\r\n  }\r\n}\r\n","import { IFoto } from '../interfaces/mis-interfaces';\r\nimport { GestionStorageService } from './gestion-storage.service';\r\nimport { Camera, CameraResultType, CameraSource, ImageOptions, Photo } from '@capacitor/camera';\r\nimport { Injectable } from '@angular/core';\r\nimport { Directory, Filesystem } from '@capacitor/filesystem';\r\nimport { Platform } from '@ionic/angular';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FotosService {\r\n  // Array para almacenar las rutas de cada foto\r\n  public accesoFotos: IFoto[] = [];\r\n\r\n  // Carga las imágenes que tenemos almacenadas\r\n  constructor(private usarStorage: GestionStorageService, private plataforma: Platform) {\r\n    this.loadSaved();\r\n  }\r\n\r\n  // Devuelve el array para poderlo utilizar en un componente\r\n  public getFotos() {\r\n    return this.accesoFotos;\r\n  }\r\n\r\n  // Recupera las imágenes que hay almacenadas en el disco duro\r\n  private async loadSaved() {\r\n    // Recupera los datos de Storage en formato string\r\n    const photoList = await this.usarStorage.getObject(\"fotos\");\r\n\r\n    // Lo parsea a un array de objetos IFoto y lo almacena en el atributo accesoFotos\r\n    // Si no obtiene datos inicializará el array para poder empezar a almacenar fotos.\r\n    this.accesoFotos = JSON.parse(photoList.value) || [];\r\n    console.log(photoList);\r\n    \r\n    // En los navegadores debemos cargar las imágenes en formato base64 para que se visualicen correctamente\r\n    if (!this.plataforma.is(\"hybrid\")) {\r\n      // Lee los datos de cada foto guardada en el sistema de archivos\r\n      for (let photo of this.accesoFotos) {\r\n        const readFile = await Filesystem.readFile({\r\n            path: photo.filepath,\r\n            directory: Directory.Data\r\n        });\r\n\r\n        // Plataforma web solamente: Guardar la foto en base64 para que se pueda visualizar\r\n        photo.webviewPath = `data:image/jpeg;base64,${readFile.data}`;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Define las características de la foto y la saca\r\n  public async sacarFoto() {\r\n    // Definir características de la foto\r\n    let caracteristicasFoto: ImageOptions = {\r\n      resultType: CameraResultType.Uri,\r\n      source: CameraSource.Camera,\r\n      quality: 100\r\n    };\r\n    const foto: Photo = await Camera.getPhoto(caracteristicasFoto);\r\n    console.log(foto);\r\n\r\n    // Se obtiene la URL y se añade al principio del array\r\n    // let UrlFoto: string = foto.webPath;\r\n    // this.urlFotos.unshift(UrlFoto);\r\n\r\n    // En los dispositivos móviles las fotos se guardan por defecto y tenemos el path físico y el webpath para visualizar\r\n    // En el navegador hay que guardar la imagen en un fichero y se almacena su path y su URL en el array\r\n    let imagenGuardada: any;\r\n\r\n    if (!this.plataforma.is(\"hybrid\")) {\r\n      imagenGuardada = await this.savePicture(foto);\r\n    } else {\r\n      // Guarda las rutas de acceso a la foto\r\n      imagenGuardada = {\r\n        filepath: foto.path,\r\n        webviewPath: foto.webPath\r\n      };\r\n    }\r\n    this.accesoFotos.unshift(imagenGuardada);\r\n    console.log(imagenGuardada);\r\n\r\n\r\n    // Almacenamos los datos de las fotos en Storage\r\n    this.usarStorage.setObject(\"fotos\", this.accesoFotos);\r\n\r\n\r\n  }\r\n\r\n  // Se almacena la imagen en el sistema de ficheros\r\n  // Solo para el navegador\r\n  private async savePicture(cameraPhoto: Photo) {\r\n   \r\n    // Convierte la foto al formato base64, exigido por la API del sistema de ficheros\r\n    const base64Data = await this.readAsBase64(cameraPhoto);\r\n  \r\n    // Guarda el fichero\r\n    const fileName = new Date().getTime() + '.jpeg';\r\n    const savedFile = await Filesystem.writeFile({\r\n      path: fileName,\r\n      data: base64Data,\r\n      directory: Directory.Data   // Los datos se borrarn al desinstalar la aplicación\r\n    });\r\n\r\n    console.log(savedFile);\r\n\r\n    // Crea y devuelve un objeto IFoto\r\n    return {\r\n      filepath: fileName,\r\n      webviewPath: cameraPhoto.webPath\r\n    };\r\n  }\r\n\r\n  // Devuelve la imagen en formato base64 para trabajar en los navegadores\r\n  // Recupera la imagen como blob y la convierte a base64\r\n  private async readAsBase64(foto: Photo) {\r\n    const response = await fetch(foto.webPath!);\r\n    const blob = await response.blob();\r\n    const base64 = await this.convertBlobToBase64(blob) as string;\r\n    return base64;\r\n  }\r\n  \r\n  // Conviete una imagen en formato blob a formato base 64\r\n  private convertBlobToBase64(blob: Blob) {\r\n    let promesa = new Promise( function(resolve, reject) {\r\n      const reader = new FileReader;\r\n      reader.onerror = reject;\r\n      reader.onload = () => {\r\n          resolve(reader.result);\r\n      };\r\n      reader.readAsDataURL(blob);\r\n    });\r\n\r\n    return promesa;\r\n  }\r\n  \r\n  // Here's an example of reading a file with a full file path. Use this to\r\n  // read binary data (base64 encoded) from plugins that return File URIs, such as\r\n  // the Camera.\r\n  private async readFilePath() {\r\n    const contents = await Filesystem.readFile({\r\n      path: 'file:///var/mobile/Containers/Data/Application/22A433FD-D82D-4989-8BE6-9FC49DEA20BB/Documents/text.txt'\r\n    });\r\n\r\n    console.log('data:', contents);\r\n  };\r\n}\r\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}